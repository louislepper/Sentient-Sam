(this["webpackJsonpsing-me-a-song"]=this["webpackJsonpsing-me-a-song"]||[]).push([[0],{711:function(e,t,n){e.exports=n(735)},716:function(e,t,n){},717:function(e,t,n){},735:function(e,t,n){"use strict";n.r(t);var o,a=n(7),r=n.n(a),c=n(35),i=n.n(c),s=(n(716),n(717),n(41)),l=n(14),u=n(55),d=(n(77),n(26)),m=n(70),f=n(8),p={apiGateway:{URL:"/api"}},w=Object(f.a)({},p).apiGateway.URL;!function(e){e[e.SELECTION=0]="SELECTION",e[e.LOADING=1]="LOADING",e[e.PLAYING=2]="PLAYING"}(o||(o={}));var v={songStage:o.SELECTION,topic:null,words:null},h=Object(m.b)({name:"song",initialState:v,reducers:{selectTopic:function(e,t){e.songStage=o.LOADING,e.topic=t.payload},receiveSong:function(e,t){e.songStage=o.PLAYING,e.topic=t.payload.topic,e.words=t.payload.words},restart:function(e){e.songStage=o.SELECTION,e.topic=null,e.words=null}}}),g=h.actions.restart,E=h.actions,b=E.receiveSong,y=E.selectTopic,S=function(e){var t;return null===(t=e.song.words)||void 0===t?void 0:t.map((function(e){var t=e.word,n=e.sound;return{word:t,sound:Uint8Array.from(atob(n),(function(e){return e.charCodeAt(0)})).buffer}}))},N=function(e){return e.song.songStage},A=h.reducer;function O(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(s.b)();function i(){d.g(),c(function(e){return function(t){t(y(e)),window.history.pushState({topic:e},e,"?topic="+e);var n=new URLSearchParams;n.append("topic",e),n.append("limit","27"),fetch("".concat(w,"/vocalTrack?").concat(n.toString())).then((function(e){return e.json()})).then((function(e){t(b({topic:e.topic,words:e.words}))}))}}(n))}return Object(a.useEffect)((function(){var e,t=new URLSearchParams(window.location.search).get("topic");(e=t)&&0!==e.trim().length&&o(t||"")}),[]),r.a.createElement("div",{className:"col init"},r.a.createElement("form",{onSubmit:i},r.a.createElement("label",null,"Sing me a song about:",r.a.createElement("input",{className:"topicInput",value:n,type:"text",onChange:function(e){o(e.target.value)}})),r.a.createElement("div",null,r.a.createElement(u.AwesomeButton,{type:"primary",onPress:i},"Sing for me"))))}var k=n(6),C=n.n(k),j=n(9);function I(e){return t=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(e)(),function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296};var t}var L=n(62);function x(e){window.navigator.clipboard?window.navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(e){console.error("Async: Could not copy text: ",e)})):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(o){console.error("Fallback: Oops, unable to copy",o)}document.body.removeChild(t)}(e)}function T(e){return new d.c({urls:{C4:e},release:1}).toDestination()}function P(e){return G.apply(this,arguments)}function G(){return(G=Object(j.a)(C.a.mark((function e(t){var n,o,a,r,c,i,s,l,u,m,f;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(j.a)(C.a.mark((function e(t){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.d().decodeAudioData(t.sound.slice(0));case 2:return n=e.sent,e.abrupt("return",{sound:T(n),word:t.word,duration:n.duration});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return n=e.sent,e.next=5,d.e();case 5:for(o=d.f(),a=I(t[0].word),r=5,.01,60,.2,0,1,c=0;c<n.length;c++)i=n[c].sound,s=.8*n[c].duration,2,l=Math.floor(2*a()*2)-2,.1,u=.1*a()*2-.1,i.triggerAttackRelease([d.a(60+l).toFrequency()],s+u,o+r),m=0,a()<=0&&(m=1),r+=s+u+.01+m;return f=new d.b({url:"/its-not-over-til-the-bossa-nova.mp3",volume:-13,fadeOut:2}).toDestination(),d.e().then((function(){f.start(d.f(),0,r+3)})),e.abrupt("return",(function(){for(var e=0;e<n.length;e++){n[e].sound.dispose()}f.stop(d.f())}));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){console.log("Attempted to stop null song")}var M=function(){var e=R;return{stopSong:function(){e(),e=R},setStopSongFunction:function(t){e=t}}}(),B=M.stopSong,F=M.setStopSongFunction;function U(e){var t=Object(s.b)();Object(a.useEffect)((function(){P(e.words).then((function(e){F(e)}))}));var n=Object(L.d)();return r.a.createElement("div",null,r.a.createElement("div",{className:"row justify-content-md-center"},r.a.createElement("div",{className:"col-md-4"},r.a.createElement("img",{className:"playingIcon",alt:"The song has started playing",src:"music_black.svg"}))),r.a.createElement("div",{className:"row controls justify-content-md-center"},r.a.createElement("div",{className:"col-md-auto"},r.a.createElement(u.AwesomeButton,{type:"primary",onPress:function(){B(),t((function(e){window.history.pushState({},"","/"),e(g())}))}},"Start Over")),r.a.createElement("div",{className:"col-md-auto"},r.a.createElement(u.AwesomeButton,{type:"primary",onPress:function(){B(),d.g().then((function(){return P(e.words)})).then((function(e){F(e)}))}},"Replay")),r.a.createElement("div",{className:"col-md-auto"},r.a.createElement(u.AwesomeButton,{type:"primary",onPress:function(){window.navigator.share?window.navigator.share({title:"Sentient Sam sings about "+e.words[0].word,text:"Check out Sentient Sam. A robo-poet who'll sing about whatever you want it to.",url:window.location.href}).then((function(){return console.log("Successful share")})).catch((function(e){return console.log("Error sharing",e)})):(x(window.location.href),console.log("copied link to clipboard"),n.show("Copied link to clipboard"))}},"Copy link to song"))))}n(732);var W=n(698),D=n.n(W);function Y(){return r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"Invalid State"))}function J(){var e=Object(s.c)(N),t=Object(s.c)(S);switch(e){case o.SELECTION:return r.a.createElement("div",{className:"col"},r.a.createElement(O,null));case o.PLAYING:return null==t?Y():r.a.createElement("div",{className:"col"},r.a.createElement(U,{words:t}));case o.LOADING:return r.a.createElement("div",{className:"loadingAnimation"},r.a.createElement(D.a,{active:!0,color:"black",type:"line-scale-party"}));default:return Y()}}var _=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row d-flex align-items-center min-vh-100"},r.a.createElement(J,null))),r.a.createElement("footer",null,r.a.createElement("div",{className:"attribution"},r.a.createElement("div",{className:"iconsAttribution"},"Icons made by ",r.a.createElement("a",{href:"http://www.freepik.com/",title:"Freepik"},"Freepik")," from ",r.a.createElement("a",{href:"https://www.flaticon.com/",title:"Flaticon"},"www.flaticon.com")),r.a.createElement("div",{className:"musicAttribution"},"Music: It's Not Over 'Til The Bossa Nova by Shane Ivers - ",r.a.createElement("a",{href:"https://www.silvermansound.com"},"https://www.silvermansound.com")))))},q=Object(m.a)({reducer:{song:A}}),$=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(734);var H=n(699),K={position:L.b.BOTTOM_CENTER,timeout:3500,offset:"30px",transition:L.c.SCALE};i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,{store:q},r.a.createElement(L.a,Object.assign({template:H.a},K),r.a.createElement(_,null)))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");$?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):z(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):z(t,e)}))}}()}},[[711,1,2]]]);
//# sourceMappingURL=main.6e93d25d.chunk.js.map